<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WaveLab — Web Synth & Visualizer</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjNWU3YmZkIiBkPSJNMiAxMmMwLTQuNzE0IDAtNy4wNzEgMS40NjQtOC41MzZDNC45MyAyIDcuMjg2IDIgMTIgMnM3LjA3MSAwIDguNTM1IDEuNDY0QzIyIDQuOTMgMjIgNy4yODYgMjIgMTJzMCA3LjA3MS0xLjQ2NSA4LjUzNUMxOS4wNzIgMjIgMTYuNzE0IDIyIDEyIDIycy03LjA3MSAwLTguNTM2LTEuNDY1QzIgMTkuMDcyIDIgMTYuNzE0IDIgMTIiIG9wYWNpdHk9IjAuNSIvPjxwYXRoIGZpbGw9IiM1ZTdiZmQiIGQ9Ik0xNy41NzYgMTAuNDhhLjc1Ljc1IDAgMCAwLTEuMTUyLS45NmwtMS43OTcgMi4xNTZjLS4zNy40NDUtLjU5OS43MTYtLjc4Ni44ODVhLjguOCAwIDAgMS0uMTYzLjEyMmwtLjAxMS4wMDVsLS4wMDgtLjAwNGwtLjAwMy0uMDAxYS44LjggMCAwIDEtLjE2NC0uMTIyYy0uMTg3LS4xNy0uNDE1LS40NC0uNzg2LS44ODVsLS4yOTItLjM1Yy0uMzI4LS4zOTUtLjYyNS0uNzUtLjkwMS0xYy0uMzAxLS4yNzItLjY4LS41MTQtMS4xOC0uNTE0cy0uODc4LjI0Mi0xLjE4LjUxNGMtLjI3Ni4yNS0uNTcyLjYwNS0uOSAxbC0xLjgzIDIuMTk0YS43NS43NSAwIDAgMCAxLjE1My45NmwxLjc5Ny0yLjE1NmMuMzctLjQ0NS41OTktLjcxNi43ODYtLjg4NWEuOC44IDAgMCAxIC4xNjMtLjEyMmwuMDA3LS4wMDNsLjAwNC0uMDAxcS4wMDQgMCAuMDExLjAwNGEuOC44IDAgMCAxIC4xNjQuMTIyYy4xODcuMTcuNDE1LjQ0Ljc4Ni44ODVsLjI5Mi4zNWMuMzI5LjM5NS42MjUuNzUuOTAxIDFjLjMwMS4yNzIuNjguNTE0IDEuMTguNTE0cy44NzgtLjI0MiAxLjE4LS41MTRjLjI3Ni0uMjUuNTcyLS42MDUuOS0xeiIvPjwvc3ZnPg==">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjNWU3YmZkIiBkPSJNMiAxMmMwLTQuNzE0IDAtNy4wNzEgMS40NjQtOC41MzZDNC45MyAyIDcuMjg2IDIgMTIgMnM3LjA3MSAwIDguNTM1IDEuNDY0QzIyIDQuOTMgMjIgNy4yODYgMjIgMTJzMCA3LjA3MS0xLjQ2NSA4LjUzNUMxOS4wNzIgMjIgMTYuNzE0IDIyIDEyIDIycy03LjA3MSAwLTguNTM2LTEuNDY1QzIgMTkuMDcyIDIgMTYuNzE0IDIgMTIiIG9wYWNpdHk9IjAuNSIvPjxwYXRoIGZpbGw9IiM1ZTdiZmQiIGQ9Ik0xNy41NzYgMTAuNDhhLjc1Ljc1IDAgMCAwLTEuMTUyLS45NmwtMS43OTcgMi4xNTZjLS4zNy40NDUtLjU5OS43MTYtLjc4Ni44ODVhLjguOCAwIDAgMS0uMTYzLjEyMmwtLjAxMS4wMDVsLS4wMDgtLjAwNGwtLjAwMy0uMDAxYS44LjggMCAwIDEtLjE2NC0uMTIyYy0uMTg3LS4xNy0uNDE1LS40NC0uNzg2LS44ODVsLS4yOTItLjM1Yy0uMzI4LS4zOTUtLjYyNS0uNzUtLjkwMS0xYy0uMzAxLS4yNzItLjY4LS41MTQtMS4xOC0uNTE0cy0uODc4LjI0Mi0xLjE4LjUxNGMtLjI3Ni4yNS0uNTcyLjYwNS0uOSAxbC0xLjgzIDIuMTk0YS43NS43NSAwIDAgMCAxLjE1My45NmwxLjc5Ny0yLjE1NmMuMzctLjQ0NS41OTktLjcxNi43ODYtLjg4NWEuOC44IDAgMCAxIC4xNjMtLjEyMmwuMDA3LS4wMDNsLjAwNC0uMDAxcS4wMDQgMCAuMDExLjAwNGEuOC44IDAgMCAxIC4xNjQuMTIyYy4xODcuMTcuNDE1LjQ0Ljc4Ni44ODVsLjI5Mi4zNWMuMzI5LjM5NS42MjUuNzUuOTAxIDFjLjMwMS4yNzIuNjguNTE0IDEuMTguNTE0cy44NzgtLjI0MiAxLjE4LS41MTRjLjI3Ni0uMjUuNTcyLS42MDUuOS0xeiIvPjwvc3ZnPg==">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://code.iconify.design/iconify-icon/1.0.8/iconify-icon.min.js"></script>
<style>
:root {
    --bg: #fefefe;
    --panel: #fafafa;
    --accent: #5e7bfd;
    --accent2: #848ff5;
    --text: #383838;
    --font: 'Outfit', sans-serif;
    --track-bg: #ccc;
    --thumb-size: 26px;
}
[data-theme="dark"] {
    --bg: #121212;
    --panel: #1e1e1e;
    --text: #e0e0e0;
    --track-bg: var(--accent);
}
[data-theme="dark"] #header {
    background: var(--bg);
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    border-bottom: 1px solid #333;
}
[data-theme="dark"] .panel {
    background: var(--panel);
    box-shadow: 0 2px 12px rgba(0,0,0,0.2);
    border: 1px solid #333;
}
[data-theme="dark"] select, [data-theme="dark"] button {
    background: #2a2a2a;
    color: var(--text);
    border: 1px solid #444;
}
[data-theme="dark"] button:hover {
    background: var(--accent2);
    color: #000;
}
[data-theme="dark"] .info-item {
    border-bottom: 1px solid #555;
}
[data-theme="dark"] .warning {
    background: rgba(253, 123, 94, 0.3);
}
[data-theme="dark"] footer {
    color: #999;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  overflow-x: hidden;
  padding-top: 4rem;
}
a {
  text-decoration: none;
  color: var(--accent);
}
#header {
    position: fixed;
    top: 0;
    left: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 2rem;
    background: var(--bg);
    z-index: 1000;
    width: 100%;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-bottom: 1px solid #e0e0e0;
}
h1 {
  color: var(--accent);
  letter-spacing: 1px;
  margin: 20px 0;
  text-align: center;
}
#visualizer {
  width: 90%;
  max-width: 800px;
  height: 250px;
  background: #000;
  border: 2px solid var(--accent);
  border-radius: 10px;
  box-shadow: 0 0 25px rgba(102,252,241,0.2);
  margin-bottom: 30px;
}
.controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 16px;
  width: 90%;
  max-width: 1100px;
  margin-bottom: 40px;
}
.panel {
  background: var(--panel);
  border-radius: 12px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.13);
  border: 1px solid #f2f2f2;
}
.panel h2 {
  margin: 0 0 10px;
  color: var(--accent);
  font-size: 1.1rem;
}
label {
  font-size: 0.9rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
}
.range-group {
  display: flex;
  align-items: center;
  gap: 6px;
}
input[type="range"] {
  width: 100px;
  accent-color: var(--accent2);
}
input[type="number"] {
  width: 60px;
  background: #111;
  color: var(--accent);
  border: 1px solid var(--accent2);
  border-radius: 6px;
  padding: 3px 5px;
  font-family: var(--font);
}
select, button {
  background: #f1f1f1;
  color: var(--accent);
  border: 1px solid var(--accent2);
  padding: 6px 10px;
  border-radius: 6px;
  font-family: var(--font);
  cursor: pointer;
  transition: 0.2s;
}
button:hover {
  background: var(--accent2);
  color: #000;
}
footer {
  margin: 20px 0;
  font-size: 0.9rem;
  color: #666;
  opacity: 0.7;
}
@media(max-width:700px){
  #visualizer { height: 200px; }
}
iconify-icon {
  display: inline-flex;
  align-items: center;
  vertical-align: middle;
}
#theme-toggle {
    width: 60px;
    height: 34px;
    background: var(--track-bg);
    border-radius: 17px;
    cursor: pointer;
    border: none;
    padding: 4px;
    display: flex;
    align-items: center;
    box-sizing: border-box;
    margin-left: auto;
    transition: background-color 0.3s ease;
}
#theme-toggle iconify-icon {
    width: var(--thumb-size);
    height: var(--thumb-size);
    background: white;
    border-radius: 50%;
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    flex-shrink: 0;
}
#theme-toggle[data-state="light"] iconify-icon {
    transform: translateX(0);
}
#theme-toggle[data-state="dark"] iconify-icon {
    transform: translateX(26px);
}
</style>
</head>
<body>
    <div id="header">
        <img src="https://muxai.github.io/assets/logo/favicon.png" alt="Mux WaveLab Logo" style="height: 2rem; width: 2rem; border-radius: 50%; margin-right: 0.75rem;">
        <h1 style="margin: 0; font-size: 1rem; line-height: 1; color: var(--accent); letter-spacing: 1px;">Mux WaveLab</h1>
        <button id="theme-toggle" data-state="light">
            <iconify-icon icon="solar:moon-bold-duotone" style="width: 1.5em; height: 1.5em; color: var(--accent);"></iconify-icon>
        </button>
    </div>
  <canvas id="visualizer"></canvas>
  
  <div class="controls">
    <div class="panel">
      <h2><iconify-icon icon="solar:soundwave-square-bold-duotone" style="width: 1em; height: 1em; color: var(--accent); margin-right: 0.5em;"></iconify-icon>Oscillator</h2>
      <label>Waveform:
        <select id="waveform">
          <option value="sine">Sine</option>
          <option value="square">Square</option>
          <option value="sawtooth">Sawtooth</option>
          <option value="triangle">Triangle</option>
        </select>
      </label>
      <label>Frequency:
        <div class="range-group">
          <input type="range" id="freq" min="5" max="25000" value="440">
          <input type="number" id="freqNum" min="50" max="2000" value="440">
          <span id="freqVal">Hz</span>
        </div>
      </label>
      <label>Detune:
        <div class="range-group">
          <input type="range" id="detune" min="-1200" max="1200" value="0">
          <input type="number" id="detuneNum" min="-1200" max="1200" value="0">
          <span id="detuneVal">¢</span>
        </div>
      </label>
    </div>

    <div class="panel">
      <h2><iconify-icon icon="solar:volume-loud-bold-duotone" style="width: 1em; height: 1em; color: var(--accent); margin-right: 0.5em;"></iconify-icon>Gain</h2>
      <label>Volume:
        <div class="range-group">
          <input type="range" id="gain" min="0" max="1" step="0.01" value="0.5">
          <input type="number" id="gainNum" min="0" max="1" step="0.01" value="0.5">
        </div>
      </label>
      <button id="play">Play</button>
      <button id="stop">Stop</button>
      <button id="exportBtn">Export</button>
      <button id="importBtn">Import</button>
      <input type="file" id="fileInput" accept=".muxwl" style="display:none;">
    </div>

    <div class="panel">
      <h2><iconify-icon icon="solar:muted-bold-duotone" style="width: 1em; height: 1em; color: var(--accent); margin-right: 0.5em;"></iconify-icon>Envelope</h2>
      <label>Attack:
        <div class="range-group">
          <input type="range" id="attack" min="0" max="2" step="0.01" value="0.1">
          <input type="number" id="attackNum" min="0" max="2" step="0.01" value="0.1">
          <span>s</span>
        </div>
      </label>
      <label>Decay:
        <div class="range-group">
          <input type="range" id="decay" min="0" max="2" step="0.01" value="0.3">
          <input type="number" id="decayNum" min="0" max="2" step="0.01" value="0.3">
          <span>s</span>
        </div>
      </label>
      <label>Sustain:
        <div class="range-group">
          <input type="range" id="sustain" min="0" max="1" step="0.01" value="0.7">
          <input type="number" id="sustainNum" min="0" max="1" step="0.01" value="0.7">
        </div>
      </label>
      <label>Release:
        <div class="range-group">
          <input type="range" id="release" min="0" max="2" step="0.01" value="0.4">
          <input type="number" id="releaseNum" min="0" max="2" step="0.01" value="0.4">
          <span>s</span>
        </div>
      </label>
    </div>

    <div class="panel">
      <h2><iconify-icon icon="solar:graph-bold-duotone" style="width: 1em; height: 1em; color: var(--accent); margin-right: 0.5em;"></iconify-icon>Filter</h2>
      <label>Type:
        <select id="filterType">
          <option value="lowpass">Lowpass</option>
          <option value="highpass">Highpass</option>
          <option value="bandpass">Bandpass</option>
        </select>
      </label>
      <label>Cutoff:
        <div class="range-group">
          <input type="range" id="cutoff" min="100" max="20000" value="5000">
          <input type="number" id="cutoffNum" min="100" max="20000" value="5000">
          <span>Hz</span>
        </div>
      </label>
      <label>Q:
        <div class="range-group">
          <input type="range" id="q" min="0.1" max="20" step="0.1" value="1">
          <input type="number" id="qNum" min="0.1" max="20" step="0.1" value="1">
        </div>
      </label>
    </div>
  </div>

  <footer>© Mux 2025</footer>

<script>
// Theme Toggle
const themeToggle = document.getElementById('theme-toggle');
const currentTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', currentTheme);
themeToggle.setAttribute('data-state', currentTheme);
const icon = themeToggle.querySelector('iconify-icon');
icon.setAttribute('icon', currentTheme === 'light' ? 'solar:moon-bold-duotone' : 'solar:sun-bold-duotone');
themeToggle.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme');
    const nextTheme = current === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', nextTheme);
    localStorage.setItem('theme', nextTheme);
    themeToggle.setAttribute('data-state', nextTheme);
    icon.setAttribute('icon', nextTheme === 'light' ? 'solar:moon-bold-duotone' : 'solar:sun-bold-duotone');
});

const ctx = new (window.AudioContext || window.webkitAudioContext)();
let osc, gainNode, filter, analyser, dataArray, bufferLength, rafId;

// Setup audio graph
function createGraph() {
  osc = ctx.createOscillator();
  gainNode = ctx.createGain();
  filter = ctx.createBiquadFilter();
  analyser = ctx.createAnalyser();
  analyser.fftSize = 2048;
  bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);
  osc.connect(filter);
  filter.connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(ctx.destination);
}

// Envelope logic
function triggerEnvelope() {
  const now = ctx.currentTime;
  const A = parseFloat(attack.value);
  const D = parseFloat(decay.value);
  const S = parseFloat(sustain.value);
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(0, now);
  gainNode.gain.linearRampToValueAtTime(parseFloat(gain.value), now + A);
  gainNode.gain.linearRampToValueAtTime(S * parseFloat(gain.value), now + A + D);
}

function releaseEnvelope() {
  if (!osc) return;
  const now = ctx.currentTime;
  const R = parseFloat(release.value);
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(gainNode.gain.value, now);
  gainNode.gain.linearRampToValueAtTime(0, now + R);
  setTimeout(()=>{
    try { osc.stop(); } catch {}
    osc.disconnect();
    cancelAnimationFrame(rafId);
  }, R*1000+50);
}

// Play/Stop
play.onclick = () => {
  ctx.resume();
  createGraph();
  osc.type = waveform.value;
  osc.frequency.value = parseFloat(freq.value);
  osc.detune.value = parseFloat(detune.value);
  filter.type = filterType.value;
  filter.frequency.value = parseFloat(cutoff.value);
  filter.Q.value = parseFloat(q.value);
  triggerEnvelope();
  osc.start();
  visualize();
};
stop.onclick = () => releaseEnvelope();

// Sync range + number inputs
function linkInputs(id) {
  const range = document.getElementById(id);
  const num = document.getElementById(id + "Num");
  if(!range || !num) return;
  range.addEventListener("input", ()=>{ num.value = range.value; updateAudioParam(id, range.value); });
  num.addEventListener("input", ()=>{ range.value = num.value; updateAudioParam(id, num.value); });
}
["freq","detune","gain","attack","decay","sustain","release","cutoff","q"].forEach(linkInputs);

function updateAudioParam(id, val){
  if(id==='freq' && osc) osc.frequency.value = parseFloat(val);
  if(id==='detune' && osc) osc.detune.value = parseFloat(val);
  if(id==='gain' && gainNode) gainNode.gain.value = parseFloat(val);
  if(id==='cutoff' && filter) filter.frequency.value = parseFloat(val);
  if(id==='q' && filter) filter.Q.value = parseFloat(val);
}

// Export / Import
exportBtn.onclick = () => {
  const config = {
    waveform: waveform.value,
    freq: freq.value,
    detune: detune.value,
    gain: gain.value,
    attack: attack.value,
    decay: decay.value,
    sustain: sustain.value,
    release: release.value,
    filterType: filterType.value,
    cutoff: cutoff.value,
    q: q.value
  };
  const blob = new Blob([JSON.stringify(config)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "wavelab-config.muxwl";
  a.click();
  URL.revokeObjectURL(url);
};
importBtn.onclick = ()=> fileInput.click();
fileInput.onchange = e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    const config = JSON.parse(reader.result);
    for(const [k,v] of Object.entries(config)){
      const el = document.getElementById(k);
      const num = document.getElementById(k+"Num");
      if(el){ el.value = v; if(num) num.value=v; }
    }
  };
  reader.readAsText(file);
};

// Visualizer
const canvas = document.getElementById('visualizer');
const c = canvas.getContext('2d');
function visualize() {
  const W = canvas.width = canvas.clientWidth;
  const H = canvas.height = canvas.clientHeight;
  function draw() {
    rafId = requestAnimationFrame(draw);
    analyser.getByteTimeDomainData(dataArray);
    c.fillStyle = "#000";
    c.fillRect(0,0,W,H);
    c.lineWidth = 2;
    const grd = c.createLinearGradient(0,0,W,H);
    grd.addColorStop(0,'#66fcf1'); grd.addColorStop(1,'#45a29e');
    c.strokeStyle = grd;
    c.beginPath();
    const slice = W / bufferLength;
    let x = 0;
    for(let i=0;i<bufferLength;i++){
      const v = dataArray[i]/128.0;
      const y = v * H/2;
      if(i===0) c.moveTo(x,y);
      else c.lineTo(x,y);
      x += slice;
    }
    c.lineTo(W,H/2);
    c.stroke();
  }
  draw();
}
</script>
</body>
</html>